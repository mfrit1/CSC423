<!DOCTYPE html>
<html>
  <head>
    <title>Nanno's Foods</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="../style.css">
  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="http://malsup.github.com/jquery.form.js"></script>
    <script type="text/javascript" src="../Scripts.js"></script>    
  

    <script type="text/javascript">
    $("#pop").on("click", function() {
    $('#imagepreview').attr('src', $('#imageresource').attr('src')); // here asign the image to the modal when the user click the enlarge link
    $('#imagemodal').modal('show'); // imagemodal is the id attribute assigned to the bootstrap modal, then i use the show function
    });
      //This loads all current vendors onto the page.
      $(document).ready(loadTable())


      function loadTable()
      {
        var url = 'getOrders.php?vendorCode=' + getQueryVariable("vendorCode"); 
        loadDoc(url, getOrders);
      }


      function loadDoc(url, cFunction) {
    //Creates an object to run php file
      var xhttp;
     xhttp=new XMLHttpRequest();
      //HERE is when the program actually switches over to the php and runs the file.
      xhttp.open("POST", url, true);
      xhttp.send();
    
    //This tells the program to run the following code once the php file has run.
      xhttp.onreadystatechange = function() {
        //A ready status of both 4 and 200 mean that the php file ran okay, meaning no errors.
        if (this.readyState == 4 && this.status == 200) {
          //cFunction can change depending on what the user enters as a parameter.
            cFunction(this);
      
        }
      };
    }
  
   function getOrders(xhttp){
      //By doing this, we take whatever strings have been echoed by the php file and put it into our current webpage. No need to load a whole new page, It edits the one we are currently on.
      document.getElementById("itemTable").innerHTML = xhttp.responseText;


    }


    function getQueryVariable(variable)
    {
       var query = window.location.search.substring(1);
       var vars = query.split("&");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
    }

  
    function goToLoginPage(){
      window.location.href = 'index.html';
    }
    //start the register vendor stuff.
  // function addItemStart() {
  
  //  loadDoc('addItem.php', addItem);
  //  }

  //  function addItem(xhttp){
  //    //By doing this, we take whatever strings have been echoed by the php file and put it into our current webpage. No need to load a whole new page, It edits the one we are currently on.
  //    document.getElementById("outsideItemTable").innerHTML = xhttp.responseText;
   
  //  $(document).ready(function() { 
  //           // bind 'myForm' and provide a simple callback function 
  //           // attach handler to form's submit event 
  //     getVendorDropdown();
  //     getCategoryDropdown();
  //     getDivisionDropdown();
  //     $('#myForm').submit(function() { 
      
  //     if(checkFunctions()){
  //     //  console.log("I MADE IT");
  //       //alert($('#myForm').serialize()+"&id=registerVendorSubmit");
  //       $(this).ajaxSubmit(); // submit the form 
  //     }
      
  //     return false; // return false to prevent normal browser submit and page navigation 
  //     })
  //       }); 
    
  //   $(document).ajaxSuccess(function (evt, jqXHR, settings) {
  //     alert("Item successfully added.");
  //     window.location.href = 'index.html';
  //   });
    
  //   $(document).ajaxError(function (evt, jqXHR, settings, err) {
  //   alert("The Item Number must be unique. That Item Number has already been taken.");
  //   });
  // }

  //  function getVendorDropdown()
  //  {
  //   loadDoc('getVendorDropdown.php', buildVendorDropdown)
  //  }
  //  function buildVendorDropdown(xhttp)
  //   {
  //       document.getElementsByName("vendorDropdown")[0].innerHTML = xhttp.responseText;
  //   }
  //  function getDivisionDropdown()
  //  {
  //   loadDoc('getDivisionDropdown.php', buildDivisionDropdown)
  //  }
  //  function buildDivisionDropdown(xhttp)
  //   {
  //     document.getElementsByName("divisionDropdown")[0].innerHTML = xhttp.responseText;
  //   }
  //    function getCategoryDropdown()
  //   {
  //    loadDoc('getCategoryDropdown.php', buildCategoryDropdown)
  //   }
  //   function buildCategoryDropdown(xhttp)
  //   {
  //       document.getElementsByName("categoryDropdown")[0].innerHTML = xhttp.responseText;
  //   }
  //   function getVendorModifyDropdown()
  //  {
  //   loadDoc('getVendorDropdown.php', buildVendorModifyDropdown)
  //  }
  //  function buildVendorModifyDropdown(xhttp)
  //   {
  //       document.getElementsByName("vendorDropdown")[0].innerHTML = xhttp.responseText;
  //       getDivisionModifyDropdown();
  //   }
  //  function getDivisionModifyDropdown()
  //  {
  //   loadDoc('getDivisionDropdown.php', buildDivisionModifyDropdown)
  //  }
  //  function buildDivisionModifyDropdown(xhttp)
  //   {
  //     document.getElementsByName("divisionDropdown")[0].innerHTML = xhttp.responseText;
  //     getCategoryModifyDropdown();
  //   }
  //    function getCategoryModifyDropdown()
  //   {
  //    loadDoc('getCategoryDropdown.php', buildCategoryModifyDropdown)
  //   }
  //   function buildCategoryModifyDropdown(xhttp)
  //   {
  //       document.getElementsByName("categoryDropdown")[0].innerHTML = xhttp.responseText;
  //       setDropdowns();
  //   }
  //   function getImage()
  //   {
  //     document.getElementById("itemImage").src = "../" + document.getElementById("itemImagePath").value;
  //   }
  //   function setDropdowns()
  //   {
  //     var division = $('[name="divisionDropdown"]').attr("id");
  //     $("[name='divisionDropdown'] option[value=" + division + "]").attr('selected', 'selected');
  //     var category = $('[name="categoryDropdown"]').attr("id");
  //     $("[name='categoryDropdown'] option[value=" + category + "]").attr('selected', 'selected');
  //     var vendor = $('[name="vendorDropdown"]').attr("id");
  //     $("[name='vendorDropdown'] option[value=" + vendor + "]").attr('selected', 'selected');
  //   }
  // //Start the modify vendor stuff
  function getOrderInfo(button){
    var trid = button.closest('tr').attr('id');
    var url = 'getOrderDetails.php?orderId=' + trid;
    loadDoc(url, getOrderInformation);
  }


  function getOrderInformation(xhttp){
    document.getElementById("outsideOrderTable").innerHTML = xhttp.responseText;

    document.getElementById("logoutButton").innerHTML = "Back";
    document.getElementById("logoutButton").onclick = function() { window.location.href = 'viewOrders.html?vendorCode=' + getQueryVariable("vendorCode"); }
 
  }

  //This is where the delete stuff will be
  // function deleteItem(button){
  //   var trid = button.closest('tr').attr('id');
  //   var url = 'deleteItem.php?id=' + trid;
  //   loadDoc(url, getTableRowDelete);
  // }
  // function getTableRowDelete(xhttp){
  //   document.getElementById("outsideItemTable").innerHTML = xhttp.responseText;
  //   //document.getElementsByName("stateSelect").val = $('[name="stateSelect"]').attr("id");
  //   getVendorModifyDropdown();
  //   $(document).ready(function() { 
  //           // bind 'myForm' and provide a simple callback function 
  //           // attach handler to form's submit event 
  //     $('#myForm').submit(function() { 
      
  //     //  console.log("I MADE IT");
  //       //alert($('#myForm').serialize()+"&id=registerVendorSubmit");
  //       $(this).ajaxSubmit(); // submit the form 
      
  //     return false; // return false to prevent normal browser submit and page navigation 
  //     })
  //       }); 
    
  //   $(document).ajaxSuccess(function (evt, jqXHR, settings) {
  //     confirmDelete();
  //   });
  // }
  // function confirmDelete(){
  //   alert("The Item has been deleted.");
  //   document.location.href="index.html";
  // }
    function filterTableByID() {
      var input, filter, table, tr, td, i;
      input = document.getElementById("searchBar");
      filter = input.value;
      console.log(filter);
      table = document.getElementById("itemTable");
      tr = table.getElementsByTagName("tr");
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          console.log(td.innerHTML)
          if (td.innerHTML.indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }       
      }
    }
    function filterTableByDate() {
      var input, filter, table, tr, td, i;
      input = document.getElementById("searchBar2");
      filter = input.value;
      console.log(filter);
      table = document.getElementById("itemTable");
      tr = table.getElementsByTagName("tr");
      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[1];
        if (td) {
          console.log(td.innerHTML)
          if (td.innerHTML.indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }       
      }
    }
  
  // var alertText = "The following are entered incorrectly:";
  // var alertTextLength = alertText.length;
  // function checkFunctions() {
    
  //   alertText = "The following are entered incorrectly:";
  //   checkNumber(document.getElementById("number"));
  //   checkDepartment(document.getElementById("itemDepartment"));
  //   checkSize(document.getElementById("Size"));
  //   checkItemCost(document.getElementById("itemCost"));
  //   checkRetailPrice(document.getElementById("retailPrice"));
  //   checkDescription(document.getElementById("Description"));
  //   checkDivisionDropdown(document.getElementsByName("divisionDropdown")[0]);
  //   checkCategoryDropdown(document.getElementsByName("categoryDropdown")[0]);
  //   checkVendorDropdown(document.getElementsByName("vendorDropdown")[0]);
  //   checkItemImagePath(document.getElementById("itemImagePath"));
  //   if(alertText.length == alertTextLength)
  //   {
  //     return true;
        
  //   }else{
      
  //     alert(alertText);
        
  //     return false;
      
  //   }
  // }
  // function checkDepartment(elem) {
  //     var elemPattern = /^[A-Za-z0-9\s-]+$/;
  //     var re = new RegExp(elemPattern);
  //     if(!re.test(elem.value))
  //     {
  //       alertText = alertText.concat("\nDepartment");
  //     }
  //   }
  //   function checkSize(elem) {
  //     if(elem.value=="")
  //     {
  //       alertText = alertText.concat("\nSize");
  //     }
  //   }
  //   function checkItemCost(elem) {
  //     var elemPattern = /^\d+(\.\d{1,2})?$/;
  //     var re = new RegExp(elemPattern);
  //     if(!re.test(elem.value))
  //     {
  //       alertText = alertText.concat("\nItem Cost");
  //     }
  //   }
  //   function checkRetailPrice(elem) {
  //     var elemPattern = /^\d+(\.\d{1,2})?$/;
  //     var re = new RegExp(elemPattern);
  //     if(!re.test(elem.value))
  //     {
  //       alertText = alertText.concat("\nRetailPrice");
  //     }
  //   }
  //   function checkDescription(elem) {
  //     if(elem.value=="")
  //     {
  //       alertText = alertText.concat("\nDescription");
  //     }
  //   }
  //   function checkDivisionDropdown(elem) {
  //     if(elem.value=="")
  //     {
  //       alertText = alertText.concat("\nDivision");
  //     }
  //   }
  //   function checkCategoryDropdown(elem) {
  //     if(elem.value=="")
  //     {
  //       alertText = alertText.concat("\nCategory");
  //     }
  //   }
  //   function checkVendorDropdown(elem) {
  //     if(elem.value=="")
  //     {
  //       alertText = alertText.concat("\nVendor");
  //     }
  //   }
  //   function checkItemImagePath(elem) {
  //     var elemPattern = /^([a-zA-Z0-9\s_\\.\-\(\):])+(.jpg|.pdf)$/;
  //     var re = new RegExp(elemPattern);
  //     if(!re.test(elem.value))
  //     {
  //       alertText = alertText.concat("\nImage Name");
  //     }
  //   }
  //   function checkNumber(elem)
  //   {
  //     var elemPattern = /^\d+$/;
  //     var re = new RegExp(elemPattern);
  //     if(!re.test(elem.value))
  //     {
  //       alertText = alertText.concat("\nItem Number");
  //     }
  //   }
    </script>

  </head>


  <body style="background-color: rgb(255, 253, 239)">
    
<nav class="navbar navbar-expand-sm navbar-dark" style="background-color: black">
  <!-- Brand -->
  <a class="navbar-brand" href="index.html">Nanno's Foods</a>

</nav>
  
    <div class="container-fluid" id="mainDiv">

      <div class="row" style="padding-top: 50px">
      <!-- <div class="col-lg-1"></div> -->
        <div class="col-lg-12">
          <div style="text-align: center">
            <div class="container">
            <div class="page-header">
              <h1>Order List</h1>      
            </div>
            <hr>  
          </div>
          </div>
        </div>
      <!-- <div class="col-lg-1"></div> -->
      </div>

      <div class="row" id = "outsideOrderTable">
      <!-- <div class="col-lg-1"></div> -->
      <div class="col-lg-1">
      </div>
    <div class="col-lg-10" style="text-align: center">
          <div style="text-align: center; overflow-y:auto; max-height: 750px;" >
            <table class="table table-bordered" style="max-width: 100% " align="center" >
              <thead class="thead-dark">
                <tr>
                  <th colspan="5">
                    <form class="form-inline my-2 my-lg-0">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search Order ID" aria-label="Search" id="searchBar" onkeyup="filterTableByID()">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search Order Start Date" aria-label="Search" id="searchBar2" onkeyup="filterTableByDate()">
                    </form>
                  </th>
                  <th colspan="5">
                    <form class="form-inline my-2 my-lg-0" style="float: right;">
                  </form>
                  </th>
                </tr>
              </thead>
              <thead class="thead-dark">
                <tr>
                  <th scope="col" onclick="loadDoc('getOrders.php', getItems)">Order ID</th>
                  <th scope="col" onclick="loadDoc('getOrersByDate.php', getItems)">Date and Time of Order</th>
                  <th scope="col">Store Name</th>
                  <th scope="col">Status</th>
                  <th scope="col">Date and Time of Completion</th>
                  <th scope="col" wdith="200px">More Info...</th>
                </tr>
              </thead>
              <tbody id = "itemTable" style="background-color: white;">
              </tbody>
            </table>

          </div>
      <!-- <div class="col-lg-1"></div> -->
      </div>
      <div class="col-lg-1">
      </div>
      </div>
      <div class="row">
        <div class="col-lg-1"></div>
        <div class="col-lg-10" style="text-align: right">
          <button type='button' id="logoutButton" class='btn btn-danger' onclick='goToLoginPage()'>LOGOUT</button>
        </div>
        <div class="col-lg-1"></div>
    </div>

  </body>

</html>
